<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Observational_Data_Cross_Section | The Unidata Python Training Site</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://unidata.github.io/python-training/gallery/observational_data_cross_section/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="UCAR/Unidata">
<meta property="og:site_name" content="The Unidata Python Training Site">
<meta property="og:title" content="Observational_Data_Cross_Section">
<meta property="og:url" content="https://unidata.github.io/python-training/gallery/observational_data_cross_section/">
<meta property="og:description" content="In [ ]:

    
%matplotlib inline


    







Real Data Cross-Section Example¶Cross-section using real data from soundings.
This example uses actual soundings to create a cross-section. There are
two">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-09-17T11:15:25-06:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://unidata.github.io/python-training/">

                <span id="blog-title">The Unidata Python Training Site</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../python/intro-to-python">Introduction to Python</a>
                </li>
<li>
<a href="../gallery-home">Example Gallery</a>
                </li>
<li>
<a href="../../workshop/workshop-intro">Python Workshop Materials</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.ipynb" id="sourcelink">Source</a>
    </li>
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Observational_Data_Cross_Section</a></h1>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Real-Data-Cross-Section-Example">Real Data Cross-Section Example<a class="anchor-link" href="#Real-Data-Cross-Section-Example">¶</a>
</h2>
<p>Cross-section using real data from soundings.</p>
<p>This example uses actual soundings to create a cross-section. There are
two functions defined to help interpolate radiosonde observations, which
won’t all be at the same level, to a standard grid. The vertical
interpolation assumes a log-linear relationship. Each radisosonde
vertical profile is interpolated first, then the
<code>scipy.interpolate.griddata</code> function is used to generate a full 2D
(x, p) grid between each station. Pyproj is used to calculate the
distance between each station and the standard atmosphere is used to
convert the elevation of each station to a pressure value for plotting
purposes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">metpy.calc</span> <span class="k">as</span> <span class="nn">mpcalc</span>
<span class="kn">from</span> <span class="nn">metpy.units</span> <span class="k">import</span> <span class="n">units</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="k">import</span> <span class="n">Geod</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="k">import</span> <span class="n">gaussian_filter</span>
<span class="kn">from</span> <span class="nn">siphon.simplewebservice.wyoming</span> <span class="k">import</span> <span class="n">WyomingUpperAir</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Vertical-Interpolation-Function">Vertical Interpolation Function<a class="anchor-link" href="#Vertical-Interpolation-Function">¶</a>
</h3>
<p>Function interpolates to given pressure level data to set grid.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">vertical_interpolate</span><span class="p">(</span><span class="n">vcoord_data</span><span class="p">,</span> <span class="n">interp_var</span><span class="p">,</span> <span class="n">interp_levels</span><span class="p">):</span>
    <span class="sd">"""A function to interpolate sounding data from each station to</span>
<span class="sd">    every millibar. Assumes a log-linear relationship.</span>

<span class="sd">    Input</span>
<span class="sd">    -----</span>
<span class="sd">    vcoord_data : A 1D array of vertical level values (e.g., pressure from a radiosonde)</span>
<span class="sd">    interp_var : A 1D array of the variable to be interpolated to all pressure levels</span>
<span class="sd">    vcoord_interp_levels : A 1D array containing veritcal levels to interpolate to</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    interp_data : A 1D array that contains the interpolated variable on the interp_levels</span>
<span class="sd">    """</span>

    <span class="c1"># Make veritcal coordinate data and grid level log variables</span>
    <span class="n">lnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vcoord_data</span><span class="p">)</span>
    <span class="n">lnp_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">interp_levels</span><span class="p">)</span>

    <span class="c1"># Use numpy to interpolate from observed levels to grid levels</span>
    <span class="n">interp_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lnp_intervals</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lnp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">interp_var</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Mask for missing data (generally only near the surface)</span>
    <span class="n">mask_low</span> <span class="o">=</span> <span class="n">interp_levels</span> <span class="o">&gt;</span> <span class="n">vcoord_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mask_high</span> <span class="o">=</span> <span class="n">interp_levels</span> <span class="o">&lt;</span> <span class="n">vcoord_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="n">mask_low</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="n">mask_high</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_var</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">interp_data</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Radiosonde-Observation-Interpolation-Function">Radiosonde Observation Interpolation Function<a class="anchor-link" href="#Radiosonde-Observation-Interpolation-Function">¶</a>
</h3>
<p>This function interpolates given radiosonde data into a 2D array for all
meteorological variables given in dataframe. Returns a dictionary that
will have requesite data for plotting a cross section.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">radisonde_cross_section</span><span class="p">(</span><span class="n">stns</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">"""This function takes a list of radiosonde observation sites with a</span>
<span class="sd">    dictionary of Pandas Dataframes with the requesite data for each station.</span>

<span class="sd">    Input</span>
<span class="sd">    -----</span>
<span class="sd">    stns : List of statition three-letter identifiers</span>
<span class="sd">    data : A dictionary of Pandas Dataframes containing the radiosonde observations</span>
<span class="sd">    for the stations</span>
<span class="sd">    start : interpolation start value, optional (default = 1000 hPa)</span>
<span class="sd">    end : Interpolation end value, optional (default = 100 hPa)</span>
<span class="sd">    step : Interpolation interval, option (default = 10 hPa)</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    cross_section : A dictionary that contains the following variables</span>

<span class="sd">        grid_data : An interpolated grid with 100 points between the first and last station,</span>
<span class="sd">        with the corresponding number of vertical points based on start, end, and interval</span>
<span class="sd">        (default is 90)</span>
<span class="sd">        obs_distance : An array of distances between each radiosonde observation location</span>
<span class="sd">        x_grid : A 2D array of horizontal direction grid points</span>
<span class="sd">        p_grid : A 2D array of vertical pressure levels</span>
<span class="sd">        ground_elevation : A representation of the terrain between radiosonde observation sites</span>
<span class="sd">        based on the elevation of each station converted to pressure using the standard</span>
<span class="sd">        atmosphere</span>

<span class="sd">    """</span>
    <span class="c1"># Set up vertical grid, largest value first (high pressure nearest surface)</span>
    <span class="n">vertical_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">)</span>

    <span class="c1"># Number of vertical levels and stations</span>
    <span class="n">plevs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertical_levels</span><span class="p">)</span>
    <span class="n">nstns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stns</span><span class="p">)</span>

    <span class="c1"># Create dictionary of interpolated values and include neccsary attribute data</span>
    <span class="c1"># including lat, lon, and elevation of each station</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">elev</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">stns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">tmp_grid</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="c1"># Interpolate all variables for each radiosonde observation</span>
    <span class="c1"># Temperature, Dewpoint, U-wind, V-wind</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tmp_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">tmp_grid</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nstns</span><span class="p">,</span> <span class="n">plevs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stns</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstns</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'pressure'</span><span class="p">:</span>
                <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">station</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">station</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">elev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">station</span><span class="p">]</span><span class="o">.</span><span class="n">elevation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">tmp_grid</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">loc</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vertical_levels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_grid</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">loc</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vertical_interpolate</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s1">'pressure'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">vertical_levels</span><span class="p">)</span>

    <span class="c1"># Compute distance between each station using Pyproj</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Geod</span><span class="p">(</span><span class="n">ellps</span><span class="o">=</span><span class="s1">'sphere'</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">nstns</span><span class="o">*</span><span class="p">[</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">nstns</span><span class="o">*</span><span class="p">[</span><span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">lons</span><span class="p">[:],</span> <span class="n">lats</span><span class="p">[:])</span>

    <span class="c1"># Compute sudo ground elevation in pressure from standard atmsophere and the elevation</span>
    <span class="c1"># of each station</span>
    <span class="n">ground_elevation</span> <span class="o">=</span> <span class="n">mpcalc</span><span class="o">.</span><span class="n">height_to_pressure_std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">'meters'</span><span class="p">))</span>

    <span class="c1"># Set up grid for 2D interpolation</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">pp</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">vertical_levels</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">pdist</span><span class="p">,</span> <span class="n">ddist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">vertical_levels</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>

    <span class="c1"># Interpolate to 2D grid using scipy.interpolate.griddata</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">grid</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">plevs</span><span class="p">))</span>
        <span class="n">grid</span><span class="p">[</span><span class="n">key</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">((</span><span class="n">ddist</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">pdist</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span>
                                <span class="n">tmp_grid</span><span class="p">[</span><span class="n">key</span><span class="p">][:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                                <span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">pp</span><span class="p">),</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">'cubic'</span><span class="p">)</span>

    <span class="c1"># Gather needed data in dictionary for return</span>
    <span class="n">cross_section</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'grid_data'</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span> <span class="s1">'obs_distance'</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
                     <span class="s1">'x_grid'</span><span class="p">:</span> <span class="n">xx</span><span class="p">,</span> <span class="s1">'p_grid'</span><span class="p">:</span> <span class="n">pp</span><span class="p">,</span> <span class="s1">'elevation'</span><span class="p">:</span> <span class="n">ground_elevation</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">cross_section</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Stations-and-Time">Stations and Time<a class="anchor-link" href="#Stations-and-Time">¶</a>
</h3>
<p>Select cross section stations by creating a list of three-letter
identifiers and choose a date by creating a datetime object</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># A roughly east-west cross section</span>
<span class="n">stn_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'DNR'</span><span class="p">,</span> <span class="s1">'LBF'</span><span class="p">,</span> <span class="s1">'OAX'</span><span class="p">,</span> <span class="s1">'DVN'</span><span class="p">,</span> <span class="s1">'DTX'</span><span class="p">,</span> <span class="s1">'BUF'</span><span class="p">]</span>

<span class="c1"># Set a date and hour of your choosing</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-Radiosonde-Data">Get Radiosonde Data<a class="anchor-link" href="#Get-Radiosonde-Data">¶</a>
</h3>
<p>This example is built around the data from the University of Wyoming
sounding archive and using the Siphon package to remotely access that
data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Set up empty dictionary to fill with Wyoming Sounding data</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Loop over stations to get data and put into dictionary</span>
<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stn_list</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">WyomingUpperAir</span><span class="o">.</span><span class="n">request_data</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">station</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Interpolated-fields">Create Interpolated fields<a class="anchor-link" href="#Create-Interpolated-fields">¶</a>
</h3>
<p>Use the function <code>radisonde_cross_section</code> to generate the 2D grid (x,
p) for all radiosonde variables including, Temperature, Dewpoint,
u-component of the wind, and v-component of the wind.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xsect</span> <span class="o">=</span> <span class="n">radisonde_cross_section</span><span class="p">(</span><span class="n">stn_list</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-Variables-for-Plotting">Calculate Variables for Plotting<a class="anchor-link" href="#Calculate-Variables-for-Plotting">¶</a>
</h3>
<p>Use MetPy to calculate common variables for plotting a cross section,
specifically potential temperature and mixing ratio</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">potemp</span> <span class="o">=</span> <span class="n">mpcalc</span><span class="o">.</span><span class="n">potential_temperature</span><span class="p">(</span>
    <span class="n">xsect</span><span class="p">[</span><span class="s1">'p_grid'</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">'hPa'</span><span class="p">),</span> <span class="n">xsect</span><span class="p">[</span><span class="s1">'grid_data'</span><span class="p">][</span><span class="s1">'temperature'</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">'degC'</span><span class="p">))</span>

<span class="n">relhum</span> <span class="o">=</span> <span class="n">mpcalc</span><span class="o">.</span><span class="n">relative_humidity_from_dewpoint</span><span class="p">(</span>
    <span class="n">xsect</span><span class="p">[</span><span class="s1">'grid_data'</span><span class="p">][</span><span class="s1">'temperature'</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">'degC'</span><span class="p">),</span>
    <span class="n">xsect</span><span class="p">[</span><span class="s1">'grid_data'</span><span class="p">][</span><span class="s1">'dewpoint'</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">'degC'</span><span class="p">))</span>

<span class="n">mixrat</span> <span class="o">=</span> <span class="n">mpcalc</span><span class="o">.</span><span class="n">mixing_ratio_from_relative_humidity</span><span class="p">(</span><span class="n">relhum</span><span class="p">,</span>
                                                    <span class="n">xsect</span><span class="p">[</span><span class="s1">'grid_data'</span><span class="p">][</span><span class="s1">'temperature'</span><span class="p">]</span> <span class="o">*</span>
                                                    <span class="n">units</span><span class="p">(</span><span class="s1">'degC'</span><span class="p">),</span>
                                                    <span class="n">xsect</span><span class="p">[</span><span class="s1">'p_grid'</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">'hPa'</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Plot-Cross-Section">Plot Cross Section<a class="anchor-link" href="#Plot-Cross-Section">¶</a>
</h3>
<p>Use standard Matplotlib to plot the now 2D cross section grid using the
data from xsect and those calculated above. Additionally, the actualy
radiosonde wind observations are plotted as barbs on this plot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Start Figure, set big size for cross section</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>

<span class="c1"># Specify plotting axis (single panel)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Set y-scale to be log since pressure decreases exponentially with height</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="c1"># Set limits, tickmarks, and ticklabels for y-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">1030</span><span class="p">,</span> <span class="mi">101</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">))</span>

<span class="c1"># Invert the y-axis since pressure decreases with increasing height</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

<span class="c1"># Plot the sudo elevation on the cross section</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'obs_distance'</span><span class="p">],</span> <span class="n">xsect</span><span class="p">[</span><span class="s1">'elevation'</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1030</span><span class="p">,</span>
                <span class="n">where</span><span class="o">=</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'elevation'</span><span class="p">]</span><span class="o">.</span><span class="n">m</span> <span class="o">&lt;=</span> <span class="mi">1030</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'lightgrey'</span><span class="p">,</span>
                <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Don't plot xticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([],</span> <span class="p">[])</span>

<span class="c1"># Plot wind barbs for each sounding location</span>
<span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">stn_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stn_list</span><span class="p">)),</span> <span class="n">stn_list</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'obs_distance'</span><span class="p">][</span><span class="n">stn</span><span class="p">],</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'obs_distance'</span><span class="p">][</span><span class="n">stn</span><span class="p">],</span> <span class="mi">1100</span><span class="p">,</span> <span class="n">stn_name</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'obs_distance'</span><span class="p">][</span><span class="n">stn</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">stn_name</span><span class="p">][</span><span class="s1">'pressure'</span><span class="p">][::</span><span class="mi">2</span><span class="p">],</span>
             <span class="n">df</span><span class="p">[</span><span class="n">stn_name</span><span class="p">][</span><span class="s1">'u_wind'</span><span class="p">][::</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
             <span class="n">df</span><span class="p">[</span><span class="n">stn_name</span><span class="p">][</span><span class="s1">'v_wind'</span><span class="p">][::</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Plot smoothed potential temperature grid (K)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'x_grid'</span><span class="p">],</span> <span class="n">xsect</span><span class="p">[</span><span class="s1">'p_grid'</span><span class="p">],</span> <span class="n">gaussian_filter</span><span class="p">(</span>
    <span class="n">potemp</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">'</span><span class="si">%i</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Plot smoothed mixing ratio grid (g/kg)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xsect</span><span class="p">[</span><span class="s1">'x_grid'</span><span class="p">],</span> <span class="n">xsect</span><span class="p">[</span><span class="s1">'p_grid'</span><span class="p">],</span> <span class="n">gaussian_filter</span><span class="p">(</span>
    <span class="n">mixrat</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'tab:green'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">'</span><span class="si">%i</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Add some informative titles</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross-Section from DNR to BUF Potential Temp. '</span>
          <span class="s1">'(K; red) and Mix. Rat. (g/kg; green)'</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'right'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2019         <a href="mailto:support-python@ucar.edu">UCAR/Unidata</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
